<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Owner Dashboard</title>
    <style>
    body {
    font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #F5F5F5;
    display: flex;
    height: 100vh;
}

/* Sidebar Menu */
.menu {
    width: 70px;
    background: #1e00c4;
    padding: 20px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: width 0.3s ease-in-out;
    position: fixed;
    height: 100vh;
    box-shadow: 2px 0px 5px rgba(19, 7, 255, 0.2);
    overflow: hidden;
}
/* عند مرور الماوس تكبر القائمة */
.menu:hover {
    width: 250px;
}
.menu button {
    background: transparent;
    color: white;
    border: none;
    padding: 12px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease-in-out;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    text-align: left;
    opacity: 0.8;
}

/* Button Hover Effects */
.menu button:hover {
    background: #0c014c96;
    transform: scale(1.1);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    opacity: 1;
}

/* Icons for Sidebar */
.menu button i {
    font-size: 18px;
}
.content {
    flex: 1;
    padding: 20px;
    margin-left: 10px; /* Adjusts content position */
    transition: margin-left 0.3s ease-in-out;
}
.menu:hover ~ .content {
    margin-left: 250px;
}

/* Top Bar */
.topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* تعديل الصفحة الرئيسية لتجنب تغطية القائمة */
.dashboard {
    flex-grow: 1;
    padding: 20px;
    margin-left: 70px; /* Adjusts content position */
    transition: margin-left 0.3s ease-in-out;
}

/* عند تكبير القائمة، تتحرك الصفحة الرئيسية */
.menu:hover ~ .dashboard {
    margin-left: 250px;
}


        .header {
            display: flex;
            flex-direction: column; /* ✅ يجعل العناصر تحت بعض */
            align-items:flex-start; /* ✅ محاذاة لليسار */
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .booking-list {
            list-style: none;
            padding: 0;
        }

        .booking-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-bottom: 1px solid #DDDFE1;
        }

        .booking-images {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .booking-images img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
        }

        .button {
    background: #0033ff;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    font-size: 16px;
    font-weight: bold;
}

/* Button Hover Animation */
.button:hover {
    background: #406cff;
    transform: scale(1.1);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

/* عند تمرير الماوس يكبر الزر */
.button:hover {
    background: #406cff;
    transform: scale(1.1);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

/* عند إخراج الماوس، يعود الزر بحركة سلسة */
.button:not(:hover) {
    animation: exitFade 0.3s ease-in-out;
}

@keyframes exitFade {
    0% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 0.9; }
}
/* تأثير الاهتزاز عند النقر */
.button:active {
    animation: shake 0.3s ease-in-out;
}

/* Save Button Pulse Effect */
#save-booking {
    animation: pulse 1.5s infinite;
}

/* Edit & Delete Buttons */
.edit-btn {
    color: #000;
    background: #eaff00;
}
.edit-btn:hover {
    background: #909d01;
    color: #ffffff;
    transform: scale(1.1);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.delete-btn {
    color: #000;
    background: #ff1900;
}
.delete-btn:hover {
    background: #730c00;
    color: #ffffff;
    transform: scale(1.1);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}
/* تأثير الظهور التدريجي عند تحميل الصفحة */


        /* نافذة إضافة / تعديل الحجز */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            text-align: center;
            position: relative;
        }

        .modal input, .modal textarea, .modal select {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        textarea {
            resize: none;
        }

        .modal button {
            background: #406cff;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .modal button:hover {
            background: #202289;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            color: red;
        }

        /* تبويبات المحتوى */
        .tab {
            overflow: hidden;
            background-color: #f1f1f1;
            border-radius: 8px 8px 0 0;
            margin-bottom: 15px;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
            border-radius: 8px 8px 0 0;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #0033ff;
            color: white;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border-top: none;
        }

        /* عرض الفنادق والفعاليات */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .item-image {
            height: 180px;
            overflow: hidden;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-details {
            padding: 15px;
        }

        .item-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .item-location, .item-price, .item-description {
            margin-bottom: 6px;
            font-size: 14px;
        }

        .item-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        /* أزرار الإضافة */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-hotel-btn {
            background: #0033ff;
        }

        .add-event-btn {
            background: #00a86b;
        }

        body {
          font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div class="menu">
        <h2 style="color: white; font-size: 20px; text-align: center;">Dashboard</h2>
        <button id="home-btn"><i>📊</i> Home</button>
        <button id="bookings-btn"><i>📅</i> Bookings</button>
        <button id="hotels-btn"><i>🏨</i> Hotels</button>
        <button id="events-btn"><i>🎭</i> Events</button>
        <button id="settings-btn"><i>⚙️</i> Settings</button>
        <button id="logout-btn"><i>🚪</i> Logout</button>
    </div>

    <div class="dashboard">
        <div class="header">
            <h3>Welcome, Business Owner</h3>
            <p>Manage your hotels and events</p>
        </div>

        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'HotelsTab')">Hotels</button>
            <button class="tablinks" onclick="openTab(event, 'EventsTab')">Events</button>
        </div>

        <!-- Hotels Tab -->
        <div id="HotelsTab" class="tabcontent" style="display: block;">
            <div class="action-buttons">
                <button class="button add-hotel-btn" id="add-hotel-btn">➕ Add New Hotel</button>
            </div>

            <div class="items-grid" id="hotels-grid">
                <!-- Hotel items will be loaded here -->
            </div>
        </div>

        <!-- Events Tab -->
        <div id="EventsTab" class="tabcontent">
            <div class="action-buttons">
                <button class="button add-event-btn" id="add-event-btn">➕ Add New Event</button>
            </div>

            <div class="items-grid" id="events-grid">
                <!-- Event items will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal for Adding / Editing Hotel -->
    <div class="modal" id="hotel-modal">
        <div class="modal-content">
            <span class="close-btn" id="close-hotel-modal">❌</span>
            <h3 id="hotel-modal-title">Add New Hotel</h3>
            <input type="text" id="hotel-name" placeholder="Hotel Name">
            <label for="hotel-location">Location:</label>
            <input type="text" id="hotel-location" placeholder="e.g. Abha, Saudi Arabia" required>
            <div style="margin-top: 10px;">
                <button type="button" id="locate-on-map" style="background: #1D4ED8; color: white; border: none; padding:                 5px 10px; border-radius: 5px; cursor: pointer;">Locate on Map</button>
            </div>
            <div id="location-map" style="width: 100%; height: 200px; margin-top: 10px; display: none;"></div>
            <input type="number" id="hotel-price" placeholder="Price per night">
            <textarea id="hotel-description" placeholder="Hotel Description" style="resize: none;"></textarea>
            <input type="text" id="hotel-features" placeholder="Features (comma separated)">
            <input type="file" id="hotel-images" multiple accept="image/*">
            <input type="hidden" id="hotel-latitude">
            <input type="hidden" id="hotel-longitude">
            <div id="hotel-images-preview" style="display: flex; flex-wrap: wrap; gap: 5px; margin: 10px 0;"></div>
            <input type="hidden" id="hotel-id">
            <button id="save-hotel">Save Hotel</button>
        </div>
    </div>

    <!-- Modal for Adding / Editing Event -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <span class="close-btn" id="close-event-modal">❌</span>
            <h3 id="event-modal-title">Add New Event</h3>
            <input type="text" id="event-name" placeholder="Event Name">
            <input type="text" id="event-location" placeholder="Location">
            <input type="number" id="event-price" placeholder="Price">
            <textarea id="event-description" placeholder="Event Description" style="resize: none;"></textarea>
            <input type="datetime-local" id="event-date" placeholder="Event Date">
            <input type="number" id="event-capacity" placeholder="Capacity">
            <input type="file" id="event-images" multiple accept="image/*">
            <div id="event-images-preview" style="display: flex; flex-wrap: wrap; gap: 5px; margin: 10px 0;"></div>
            <input type="hidden" id="event-id">
            <button id="save-event">Save Event</button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDPNvJy8vKpj1wZdbl-EU_yTU56xNwyPac&libraries=places&loading=async"></script>
    <script>
        // User data
        let currentUser = null;

        // Data storage
        let hotels = JSON.parse(localStorage.getItem("hotels")) || [];
        let events = JSON.parse(localStorage.getItem("events")) || [];

        // Helper for converting file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Initialize the page
        document.addEventListener("DOMContentLoaded", function() {
            // Check if user is logged in
            checkUserLoggedIn();

            // Render hotels and events
            renderHotels();
            renderEvents();

            // Tab functionality
            document.querySelectorAll('.tablinks').forEach(button => {
                button.addEventListener('click', function(event) {
                    openTab(event, this.textContent === 'Hotels' ? 'HotelsTab' : 'EventsTab');
                });
            });

            // Hotel modal
            document.getElementById("add-hotel-btn").addEventListener("click", () => {
                document.getElementById("hotel-modal-title").textContent = "Add New Hotel";
                document.getElementById("hotel-name").value = "";
                document.getElementById("hotel-location").value = "";
                document.getElementById("hotel-price").value = "";
                document.getElementById("hotel-description").value = "";
                document.getElementById("hotel-features").value = "";
                document.getElementById("hotel-images").value = "";
                document.getElementById("hotel-images-preview").innerHTML = "";
                document.getElementById("hotel-id").value = "";
                document.getElementById("hotel-latitude").value = "";
                document.getElementById("hotel-longitude").value = "";
                document.getElementById("hotel-modal").style.display = "flex";
                initMap(); // Initialize map on modal open
            });

            document.getElementById("close-hotel-modal").addEventListener("click", () => {
                document.getElementById("hotel-modal").style.display = "none";
            });

            // Event modal
            document.getElementById("add-event-btn").addEventListener("click", () => {
                document.getElementById("event-modal-title").textContent = "Add New Event";
                document.getElementById("event-name").value = "";
                document.getElementById("event-location").value = "";
                document.getElementById("event-price").value = "";
                document.getElementById("event-description").value = "";
                document.getElementById("event-date").value = "";
                document.getElementById("event-capacity").value = "";
                document.getElementById("event-images").value = "";
                document.getElementById("event-images-preview").innerHTML = "";
                document.getElementById("event-id").value = "";
                document.getElementById("event-modal").style.display = "flex";
            });

            document.getElementById("close-event-modal").addEventListener("click", () => {
                document.getElementById("event-modal").style.display = "none";
            });

            // Save hotel
            document.getElementById("save-hotel").addEventListener("click", async () => {
                const name = document.getElementById("hotel-name").value.trim();
                const location = document.getElementById("hotel-location").value.trim();
                const price = document.getElementById("hotel-price").value.trim();
                const description = document.getElementById("hotel-description").value.trim();
                const features = document.getElementById("hotel-features").value.trim().split(',').map(f => f.trim()).filter(f => f);
                const imagesInput = document.getElementById("hotel-images").files;
                const hotelId = document.getElementById("hotel-id").value;
                const latitude = document.getElementById('hotel-latitude').value;
                const longitude = document.getElementById('hotel-longitude').value;

                if (!name || !location || !price || !description) {
                    Swal.fire("Error!", "Please fill all required fields!", "error");
                    return;
                }

                let imageUrls = [];
                if (imagesInput.length > 0) {
                    for (let i = 0; i < imagesInput.length; i++) {
                        try {
                            const base64 = await fileToBase64(imagesInput[i]);
                            imageUrls.push(base64);
                        } catch (error) {
                            console.error("Error converting image to base64:", error);
                        }
                    }
                }

                if (hotelId) {
                    // Edit existing hotel
                    const index = hotels.findIndex(h => h.id === hotelId);
                    if (index !== -1) {
                        const existingImages = hotels[index].images || [];
                        hotels[index] = {
                            ...hotels[index],
                            name,
                            location,
                            price: Number(price),
                            description,
                            features,
                            updatedAt: new Date().toISOString(),
                            coordinates: {
                                latitude: latitude || null,
                                longitude: longitude || null
                            }
                        };

                        if (imageUrls.length > 0) {
                            hotels[index].images = [...existingImages, ...imageUrls];
                        }

                        Swal.fire("Updated!", "Hotel has been updated successfully.", "success");
                    }
                } else {
                    // Add new hotel
                    const newHotel = {
                        id: Date.now().toString(),
                        name,
                        location,
                        price: Number(price),
                        description,
                        features,
                        images: imageUrls,
                        coordinates: {
                            latitude: latitude || null,
                            longitude: longitude || null
                        },
                        rating: 0,
                        reviews: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        ownerId: currentUser.id
                    };

                    hotels.push(newHotel);
                    Swal.fire("Saved!", "Hotel has been added successfully.", "success");
                }

                localStorage.setItem("hotels", JSON.stringify(hotels));
                renderHotels();
                document.getElementById("hotel-modal").style.display = "none";
            });

            // Save event
            document.getElementById("save-event").addEventListener("click", async () => {
                const name = document.getElementById("event-name").value.trim();
                const location = document.getElementById("event-location").value.trim();
                const price = document.getElementById("event-price").value.trim();
                const description = document.getElementById("event-description").value.trim();
                const date = document.getElementById("event-date").value;
                const capacity = document.getElementById("event-capacity").value.trim();
                const imagesInput = document.getElementById("event-images").files;
                const eventId = document.getElementById("event-id").value;

                if (!name || !location || !price || !description || !date || !capacity) {
                    Swal.fire("Error!", "Please fill all required fields!", "error");
                    return;
                }

                let imageUrls = [];
                if (imagesInput.length > 0) {
                    for (let i = 0; i < imagesInput.length; i++) {
                        try {
                            const base64 = await fileToBase64(imagesInput[i]);
                            imageUrls.push(base64);
                        } catch (error) {
                            console.error("Error converting image to base64:", error);
                        }
                    }
                }

                if (eventId) {
                    // Edit existing event
                    const index = events.findIndex(e => e.id === eventId);
                    if (index !== -1) {
                        const existingImages = events[index].images || [];
                        events[index] = {
                            ...events[index],
                            name,
                            location,
                            price: Number(price),
                            description,
                            date,
                            capacity: Number(capacity),
                            updatedAt: new Date().toISOString()
                        };

                        if (imageUrls.length > 0) {
                            events[index].images = [...existingImages, ...imageUrls];
                        }

                        Swal.fire("Updated!", "Event has been updated successfully.", "success");
                    }
                } else {
                    // Add new event
                    const newEvent = {
                        id: Date.now().toString(),
                        name,
                        location,
                        price: Number(price),
                        description,
                        date,
                        capacity: Number(capacity),
                        images: imageUrls,
                        registeredUsers: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        ownerId: currentUser.id
                    };

                    events.push(newEvent);
                    Swal.fire("Saved!", "Event has been added successfully.", "success");
                }

                localStorage.setItem("events", JSON.stringify(events));
                renderEvents();
                document.getElementById("event-modal").style.display = "none";
            });

            // Initialize image previews
            document.getElementById("hotel-images").addEventListener("change", function(e) {
                showImagePreviews(e.target.files, 'hotel-images-preview');
            });

            document.getElementById("event-images").addEventListener("change", function(e) {
                showImagePreviews(e.target.files, 'event-images-preview');
            });

            // Navigation
            document.getElementById("home-btn").addEventListener("click", function() {
                window.location.href = "index.html";
            });

            document.getElementById("logout-btn").addEventListener("click", function() {
                localStorage.removeItem("user");
                window.location.href = "Login.html";
            });

            // Map functionality for hotel location
            document.getElementById('locate-on-map').addEventListener('click', () => {
                const locationInput = document.getElementById('hotel-location');
                const locationMap = document.getElementById('location-map');

                // Make sure map is visible
                locationMap.style.display = 'block';

                // Initialize map if not already initialized
                if (!map) {
                    map = new google.maps.Map(locationMap, {
                        center: { lat: 24.7136, lng: 46.6753 }, // Default center (Saudi Arabia)
                        zoom: 6
                    });
                }

                // Geocode the address
                geocodeAddress(locationInput.value);
            });
        });

        // Check if user is logged in
        function checkUserLoggedIn() {
            const userData = localStorage.getItem("user");
            if (!userData) {
                window.location.href = "Login.html";
                return;
            }

            currentUser = JSON.parse(userData);

            // Check if user is a business owner
            if (currentUser.role !== 'owner') {
                Swal.fire({
                    title: "Access Denied",
                    text: "You must be a business owner to access this dashboard",
                    icon: "error",
                    confirmButtonText: "Go to Login"
                }).then(() => {
                    window.location.href = "Login.html";
                });
            }
        }

        // Render hotels
        function renderHotels() {
            const hotelsGrid = document.getElementById("hotels-grid");
            hotelsGrid.innerHTML = "";

            // Filter hotels by owner
            const ownerHotels = hotels.filter(hotel => hotel.ownerId === currentUser.id);

            if (ownerHotels.length === 0) {
                hotelsGrid.innerHTML = "<p>No hotels yet. Click 'Add New Hotel' to create one.</p>";
                return;
            }

            ownerHotels.forEach(hotel => {
                const card = document.createElement("div");
                card.classList.add("item-card");

                let imageHtml = '<div class="item-image">';
                if (hotel.images && hotel.images.length > 0) {
                    imageHtml += `<img src="${hotel.images[0]}" alt="${hotel.name}">`;
                } else {
                    imageHtml += `<img src="https://via.placeholder.com/300x180?text=No+Image" alt="No Image">`;
                }
                imageHtml += '</div>';

                card.innerHTML = `
                    ${imageHtml}
                    <div class="item-details">
                        <div class="item-title">${hotel.name}</div>
                        <div class="item-location">📍 ${hotel.location}</div>
                        <div class="item-price">💲 ${hotel.price} SR per night</div>
                        <div class="item-description"> ${hotel.description.substring(0, 100)}${hotel.description.length > 100 ? '...' : ''} 
                        </div>
                        <div class="item-actions">
                            <button class="button edit-btn" onclick="editHotel('${hotel.id}')">✏️ Edit</button>
                            <button class="button delete-btn" onclick="confirmDeleteHotel('${hotel.id}')">🗑️ Delete</button>
                        </div>
                    </div>
                `;

                hotelsGrid.appendChild(card);
            });
        }

        // Render events
        function renderEvents() {
            const eventsGrid = document.getElementById("events-grid");
            eventsGrid.innerHTML = "";

            // Filter events by owner
            const ownerEvents = events.filter(event => event.ownerId === currentUser.id);

            if (ownerEvents.length === 0) {
                eventsGrid.innerHTML = "<p>No events yet. Click 'Add New Event' to create one.</p>";
                return;
            }

            ownerEvents.forEach(event => {
                const card = document.createElement("div");
                card.classList.add("item-card");

                let imageHtml = '<div class="item-image">';
                if (event.images && event.images.length > 0) {
                    imageHtml += `<img src="${event.images[0]}" alt="${event.name}">`;
                } else {
                    imageHtml += `<img src="https://via.placeholder.com/300x180?text=No+Image" alt="No Image">`;
                }
                imageHtml += '</div>';

                const eventDate = new Date(event.date).toLocaleString();

                card.innerHTML = `
                    ${imageHtml}
                    <div class="item-details">
                        <div class="item-title">${event.name}</div>
                        <div class="item-location">📍 ${event.location}</div>
                        <div class="item-price">💲 ${event.price} SR</div>
                        <div class="item-description">${event.description.substring(0, 100)}${event.description.length > 100 ? '...' : ''}</div>
                        <div><strong>Date:</strong> ${eventDate}</div>
                        <div><strong>Capacity:</strong> ${event.capacity} people</div>
                        <div class="item-actions">
                            <button class="button edit-btn" onclick="editEvent('${event.id}')">✏️ Edit</button>
                            <button class="button delete-btn" onclick="confirmDeleteEvent('${event.id}')">🗑️ Delete</button>
                        </div>
                    </div>
                `;

                eventsGrid.appendChild(card);
            });
        }

        // Edit hotel
        function editHotel(id) {
            const hotel = hotels.find(h => h.id === id);
            if (!hotel) return;

            document.getElementById("hotel-modal-title").textContent = "Edit Hotel";
            document.getElementById("hotel-name").value = hotel.name;
            document.getElementById("hotel-location").value = hotel.location;
            document.getElementById("hotel-price").value = hotel.price;
            document.getElementById("hotel-description").value = hotel.description;
            document.getElementById("hotel-features").value = hotel.features ? hotel.features.join(', ') : '';
            document.getElementById("hotel-id").value = hotel.id;
            document.getElementById("hotel-latitude").value = hotel.coordinates ? hotel.coordinates.latitude : '';
            document.getElementById("hotel-longitude").value = hotel.coordinates ? hotel.coordinates.longitude : '';


            // Display existing images
            const previewContainer = document.getElementById("hotel-images-preview");
            previewContainer.innerHTML = "";

            if (hotel.images && hotel.images.length > 0) {
                hotel.images.forEach(imgUrl => {
                    const imgPreview = document.createElement("div");
                    imgPreview.style.position = "relative";
                    imgPreview.style.display = "inline-block";
                    imgPreview.style.margin = "5px";

                    const img = document.createElement("img");
                    img.src = imgUrl;
                    img.style.width = "80px";
                    img.style.height = "80px";
                    img.style.objectFit = "cover";
                    img.style.borderRadius = "4px";

                    imgPreview.appendChild(img);
                    previewContainer.appendChild(imgPreview);
                });
            }

            document.getElementById("hotel-modal").style.display = "flex";
            initMap(); // Initialize map on modal open
        }

        // Edit event
        function editEvent(id) {
            const event = events.find(e => e.id === id);
            if (!event) return;

            document.getElementById("event-modal-title").textContent = "Edit Event";
            document.getElementById("event-name").value = event.name;
            document.getElementById("event-location").value = event.location;
            document.getElementById("event-price").value = event.price;
            document.getElementById("event-description").value = event.description;
            document.getElementById("event-date").value = event.date;
            document.getElementById("event-capacity").value = event.capacity;
            document.getElementById("event-id").value = event.id;

            // Display existing images
            const previewContainer = document.getElementById("event-images-preview");
            previewContainer.innerHTML = "";

            if (event.images && event.images.length > 0) {
                event.images.forEach(imgUrl => {
                    const imgPreview = document.createElement("div");
                    imgPreview.style.position = "relative";
                    imgPreview.style.display = "inline-block";
                    imgPreview.style.margin = "5px";

                    const img = document.createElement("img");
                    img.src = imgUrl;
                    img.style.width = "80px";
                    img.style.height = "80px";
                    img.style.objectFit = "cover";
                    img.style.borderRadius = "4px";

                    imgPreview.appendChild(img);
                    previewContainer.appendChild(imgPreview);
                });
            }

            document.getElementById("event-modal").style.display = "flex";
        }

        // Confirm delete hotel
        function confirmDeleteHotel(id) {
            Swal.fire({
                title: "Are you sure?",
                text: "You will not be able to recover this hotel!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it!",
                cancelButtonText: "Cancel"
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteHotel(id);
                }
            });
        }

        // Delete hotel
        function deleteHotel(id) {
            hotels = hotels.filter(hotel => hotel.id !== id);
            localStorage.setItem("hotels", JSON.stringify(hotels));
            renderHotels();
            Swal.fire("Deleted!", "Hotel has been deleted.", "success");
        }

        // Confirm delete event
        function confirmDeleteEvent(id) {
            Swal.fire({
                title: "Are you sure?",
                text: "You will not be able to recover this event!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it!",
                cancelButtonText: "Cancel"
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteEvent(id);
                }
            });
        }

        // Delete event
        function deleteEvent(id) {
            events = events.filter(event => event.id !== id);
            localStorage.setItem("events", JSON.stringify(events));
            renderEvents();
            Swal.fire("Deleted!", "Event has been deleted.", "success");
        }

        // Open tab
        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;

            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Show image previews
        function showImagePreviews(files, previewId) {
            const previewContainer = document.getElementById(previewId);
            previewContainer.innerHTML = "";

            if (files.length > 0) {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgPreview = document.createElement("div");
                        imgPreview.style.position = "relative";
                        imgPreview.style.display = "inline-block";
                        imgPreview.style.margin = "5px";

                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.style.width = "80px";
                        img.style.height = "80px";
                        img.style.objectFit = "cover";
                        img.style.borderRadius = "4px";

                        imgPreview.appendChild(img);
                        previewContainer.appendChild(imgPreview);
                    }
                    reader.readAsDataURL(file);
                });
            }
        }

        // Google Maps functionality
        let map;

        function initMap() {
            const locationMap = document.getElementById('location-map');
            map = new google.maps.Map(locationMap, {
                center: { lat: 21.5433, lng: 39.1729 }, // Default center (Saudi Arabia)
                zoom: 4
            });

            const autocomplete = new google.maps.places.Autocomplete(document.getElementById('hotel-location'));
            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                if (place.geometry) {
                    const location = place.geometry.location;
                    map.setCenter(location);
                    map.setZoom(12);
                    document.getElementById('hotel-latitude').value = location.lat();
                    document.getElementById('hotel-longitude').value = location.lng();
                } else {
                    console.log("No geometry found for this place");
                }
            });
        }


        function geocodeAddress(address) {
            const geocoder = new google.maps.Geocoder();
            const locationMap = document.getElementById('location-map');
            
            // Make sure the map is visible
            if (locationMap) {
                locationMap.style.display = 'block';
            } else {
                console.error("Map element not found!");
                return;
            }
            
            // Initialize map if it doesn't exist
            if (!map) {
                map = new google.maps.Map(locationMap, {
                    center: { lat: 24.7136, lng: 46.6753 }, // Default center (Saudi Arabia)
                    zoom: 6
                });
            }
            
            // Add a marker variable if it doesn't exist
            if (!window.marker) {
                window.marker = null;
            }
            
            geocoder.geocode({ address: address }, (results, status) => {
                if (status === 'OK') {
                    const location = results[0].geometry.location;
                    map.setCenter(location);
                    map.setZoom(12);
                    
                    // Remove previous marker if exists
                    if (window.marker) {
                        window.marker.setMap(null);
                    }
                    
                    // Add a new marker
                    window.marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        animation: google.maps.Animation.DROP
                    });
                    
                    // Set form values
                    document.getElementById('hotel-latitude').value = location.lat();
                    document.getElementById('hotel-longitude').value = location.lng();
                } else {
                    console.error('Geocode was not successful: ' + status);
                    Swal.fire({
                        title: "Location Error",
                        text: "Could not find this location. Please try a different address.",
                        icon: "error"
                    });
                }
            });
        }

    </script>
</body>
</html>